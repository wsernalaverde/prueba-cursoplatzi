{"version":3,"sources":["pictures-test.js"],"names":["beforeEach","t","srv","context","url","image","getImage","body","publicId","json","deepEqual","options","method","description","src","userId","resolveWithFullResponse","response","is","statusCode","id","imageNew","JSON","parse","liked","likes","images","getImages","getImagesByTag"],"mappings":"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","file":"pictures-test.js","sourcesContent":["'use strict'\n\nimport test from 'ava' // es lo mismo que require pero con la sintexis de emmascripts modules\nimport micro from 'micro'\nimport listen from 'test-listen' // es una herramienta para hacer testing de microservicios con micro\nimport request from 'request-promise' // módulo que me permite hacer http request utilizando promesas\nimport fixtures from './fixtures/'\nimport pictures from '../pictures'\n\ntest.beforeEach(async t => {\n  let srv = micro(pictures)\n  t.context.url = await listen(srv)\n})\n\ntest('GET /:id', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n\n  let body = await request({ url: `${url}/${image.publicId}`, json: true })\n  t.deepEqual(body, image)\n})\n\ntest('POST /', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n\n  let options = {\n    method: 'POST',\n    url: url,\n    json: true,\n    body: {\n      description: image.description,\n      src: image.src,\n      userId: image.userId\n    },\n    resolveWithFullResponse: true\n  }\n\n  let response = await request(options)\n\n  t.is(response.statusCode, 201)\n  t.deepEqual(response.body, image)\n})\n\ntest('POST /:id/like', async t => {\n  let image = fixtures.getImage()\n  let url = t.context.url\n\n  let options = {\n    method: 'POST',\n    url: `${url}/${image.id}/like`,\n    json: true\n  }\n\n  let body = await request(options)\n  let imageNew = JSON.parse(JSON.stringify(image)) // acá clonamos la imagen\n  imageNew.liked = true\n  imageNew.likes = 1\n\n  t.deepEqual(body, imageNew)\n})\n\ntest('GET /list', async t => {\n  let images = fixtures.getImages()\n  let url = t.context.url\n\n  let options = {\n    method: 'GET',\n    url: `${url}/list`,\n    json: true\n  }\n\n  let body = await request(options)\n\n  t.deepEqual(body, images)\n})\n\ntest('GET /tag/:tag', async t => {\n  let images = fixtures.getImagesByTag()\n  let url = t.context.url\n\n  let options = {\n    method: 'GET',\n    url: `${url}/tag/awesome`,\n    json: true\n  }\n\n  let body = await request(options)\n  t.deepEqual(body, images)\n})\n"]}